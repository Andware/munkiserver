<%= computer_header(@computer) %>
<p>
	<% if @computer.description.blank? %>
		<em>No description</em>
	<% else %>
		<%= @computer.description %>
	<% end -%>
</p>
<h4>Computer (<%= link_to "edit", edit_computer_url(@computer) %>)</h4>
<%= inventory(@computer,@computer) %>

<% unless @computer.computer_group.nil? %>
	<h4>Computer Group (<%= link_to "edit", edit_computer_group_url(@computer.computer_group) %>)</h4>
	<%= inventory(@computer.computer_group,@computer) %>
<% else %>
	<h4>Computer Group</h4>
	<p><em>This computer is not a member of any computer group.</em></p>
<% end -%>

<h4>Logs</h4>
<p>Last successful munki run: <strong><%= @computer.time_since_last_successful_run.capitalize %></strong></p>
<script type="text/javascript">
	jQuery(document).ready(function() {
		jQuery('.log-details').hide();
		jQuery('.log-link').click(function() {
			// TO-DO: Make this accordion style: only one log view open at a time
			var logDetailClass = jQuery(this).attr('data-log-detail-class');
			jQuery("." + logDetailClass).slideToggle();
			return false;
		});
	});	
</script>
<ul>
	<% @computer.recent_client_logs.each do |client_log| %>
		<li>
			<%= client_log.created_at.localtime.to_formatted_s(:long_ordinal) %> - 
			<%= client_log.run_type %>

			<% client_log.log_attributes.each do |log_name| %>
				<% unless client_log.read_attribute(log_name).blank? %>
					[<%= content_tag :a, log_name.titleize, {:class => "log-link", "data-log-detail-class" => "log-detail-#{client_log.id}-#{log_name}", :href => "#"} %>]
				<% end -%>
			<% end -%>

			<em>- <%= client_log.time_since_created_at_in_words %></em>

			<% client_log.log_attributes.each do |log_name| %>
				<% unless client_log.read_attribute(log_name).blank? %>
					<div class="log-details log-detail-<%= client_log.id %>-<%= log_name %>">
						<pre><%= client_log.read_attribute(log_name) %></pre>
					</div>
				<% end -%>
			<% end -%>
		</li>
	<% end -%>
	<% if (@computer.client_logs.count - 15) > 0 %>
		<p>...and <%= @computer.client_logs.count - 15 %> more</p>
	<% end -%>
</ul>